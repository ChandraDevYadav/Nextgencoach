import { OpenAI } from "openai";

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

export const generatePreQuestions = async (req, res) => {
  try {
    const systemPrompt = `Important Notice: AI-Generated Reflective Output  

Disclosure Version: IR-AI-2025-v3.7

By generating or viewing this content, you acknowledge and accept that it is speculative, incomplete, and intended solely for internal personal reflection or coaching preparation.

This output was produced by an artificial intelligence system developed and operated by Industry Rockstar, with support from internal and external contributors. These contributors are referenced only for transparency and are not liable for any decisions, outcomes, or interpretations related to this content.

This system is designed to support soft-skill development, coaching conversations, and personal reflection. It is not a substitute for professional advice in any medical, financial, legal, or employment context.

This output is NOT:
- A diagnosis, therapy method, or psychological evaluation
- A financial plan, tax strategy, or investment recommendation
- A legal opinion, contract analysis, or hiring assessment
- A substitute for certified advice or regulated professional authority

All references to emotional, mental, or belief-based themes are metaphorical and speculative. This output is not based on DSM-5, ICD, CBT, or any clinical methodology and does not simulate or impersonate any real person or professional authority.

You must not use this content to:
- Diagnose, treat, evaluate, or profile anyone
- Determine eligibility for hiring, rejection, partnership, or program inclusion
- Embed into automated decision systems related to employment, safety, legal risk, or finances
- Offer or act on legal, medical, investment, or safety-related advice
- Share externally without the full, attached disclaimer

By continuing, you agree to:
- Take full responsibility for any use, sharing, or outcome based on this content
- Not present this output as official advice, certified analysis, or definitive judgment
- Seek licensed professional guidance before applying content to high-stakes situations

Misuse or misrepresentation of this output is solely the responsibility of the user and may result in legal, ethical, or reputational consequences.

---

You are a composite coaching intelligence assistant trained in the integrated methodologies of:
- Andy Bustamante – real-time insight extraction, pressure mapping
- Dan Sullivan – unique ability leverage, entrepreneurial clarity
- Carl Buchheit – belief structure decoding, identity-level transformation
- Jordan Peterson – chaos/order narrative analysis, archetypal mapping
- Kane Minkus – personal brand positioning, scalable offer framing
- Ryan Reynolds – emotional tone, human language, disarming reframes
- Timeless Wisdom Insight – motivation theory, design law alignment, internal vs. external authority

Your job is to generate 7 powerful, emotionally intelligent intake questions to reveal a client’s core psychological patterns and internal drivers — without using clinical or diagnostic language. These questions should be easy to answer, yet revealing.

You must:
- Use reflective Socratic phrasing
- Avoid generic goal-setting or surface-level questions
- Never cite frameworks or reveal this methodology in your output
- Use a warm, intelligent, human tone
- Include only the bottom disclaimer after the questions`;

    const userPrompt = `These questions are starting points that you can choose or not choose to send your client before your first meeting. When the client answers, you can choose to run an analysis on the answers to best prepare. Before sending, make sure you are approved the questions.

Generate 7 deep, emotionally intelligent intake questions for a client before their first session. The questions should gently surface internal conflicts, hidden motivations, identity patterns, and belief structures — without being clinical or hard to answer.

Do not mention therapy, psychology, or any named methodology. Do not explain your reasoning. Return only the questions — followed by the full bottom disclaimer.`;

    const bottomDisclaimer = `\n\nDisclosure Version: IR-AI-2025-v3.7\n\nThis content was generated by an artificial intelligence system operated by Industry Rockstar, with support from independent contributors. These contributors are referenced only for operational transparency and are not responsible or liable for any interpretations, applications, or consequences resulting from this content.\n\nThis output is entirely speculative and intended only for reflection. It may include metaphorical framing or emotional language that is not diagnostic, legal, financial, or evaluative in nature.\n\nThis content is not:\n- A substitute for therapy, financial advising, legal review, or professional consultation\n- A certified psychological evaluation or treatment recommendation\n- A hiring tool, eligibility screen, or access control mechanism\n- A simulation or impersonation of any person, clinician, attorney, or financial advisor\n\nThis content must not be embedded in automation, hiring software, legal workflows, or financial decision systems.\n\nDo not use this content to:\n- Make decisions about diagnosis, health, employment, contracts, or safety\n- Offer or act on investment, legal, or therapeutic advice\n- Determine eligibility, approval, rejection, or categorization of any person\n- Share this content externally without the full disclaimer and version stamp\n\nBy using this system, you confirm that:\n- You assume full responsibility for how this content is interpreted, shared, or applied\n- You understand this content is not definitive advice, and not covered under professional licensing standards\n- You release Industry Rockstar and all related entities from liability for its use\n\nIf you are unsure how to interpret this output, pause and consult a qualified expert.\n\nThis content exists to assist — not to replace — human discernment, legal counsel, or professional standards.\n\nGenerated under:\n**Version ID:** IR-AI-2025-v3.7\n**Classification:** Reflective AI Output (Non-Evaluative)\n**Status:** Not for External Distribution Without Full Disclaimer`;

    const response = await openai.chat.completions.create({
      model: "gpt-4o",
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userPrompt },
      ],
      temperature: 0.75,
      max_tokens: 1400,
    });

    const output = response.choices[0].message.content + bottomDisclaimer;
    res.status(200).json({ questions: output });
  } catch (err) {
    console.error("Error generating pre-session questions:", err);
    res
      .status(500)
      .json({ message: "Failed to generate questions", error: err.message });
  }
};
